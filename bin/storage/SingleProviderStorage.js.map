{"version":3,"sources":["storage/SingleProviderStorage.ts"],"names":[],"mappings":"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","file":"SingleProviderStorage.js","sourcesContent":["import { StorageProviderConstructor } from '../types/StorageProviderConstructor';\nimport { StorageProvider } from './StorageProvider';\nimport { Util } from '../util/Util';\n\n/**\n * Simple async key/value storage abstraction operating on top of\n * a single StorageProvider instance. Each key in this storage\n * reflects a single key in the given StorageProvider\n *\n * >Supports nested object paths in get/set/remove using `.`\n * like normal object accessors\n * @param {string} name Unique identifier for this storage, used by the given StorageProvider\n * @param {StorageProviderConstructor} provider The storage provider class that will be instantiated\n * \t\t\t\t\t\t\t\t\t\t\t\tand used as the backend for this storage abstraction\n */\nexport class SingleProviderStorage\n{\n\tprivate readonly _storage: StorageProvider;\n\n\tpublic constructor(name: string, provider: StorageProviderConstructor)\n\t{\n\t\tthis._storage = new provider(name);\n\t}\n\n\t/**\n\t * Initialize this storage. Any other method calls should not be made\n\t * until this method has been called and resolved\n\t * @returns {Promise<void>}\n\t */\n\tpublic async init(): Promise<void>\n\t{\n\t\tawait this._storage.init();\n\t}\n\n\t/**\n\t * Get the names of all keys in this storage\n\t * @returns {Promise<string[]>}\n\t */\n\tpublic async keys(): Promise<string[]>\n\t{\n\t\treturn await this._storage.keys();\n\t}\n\n\t/**\n\t * Get a value from this storage for the specified key\n\t * @param {string} key The key in storage to get\n\t * @returns {Promise<any>}\n\t */\n\tpublic async get(key: string): Promise<any>\n\t{\n\t\tif (typeof key === 'undefined') throw new TypeError('Key must be provided');\n\t\tif (typeof key !== 'string') throw new TypeError('Key must be a string');\n\n\t\tif (key.includes('.'))\n\t\t{\n\t\t\tlet path: string[] = key.split('.');\n\t\t\tlet stringData: string = await this._storage.get(path.shift());\n\t\t\tif (typeof stringData === 'undefined') return;\n\t\t\tlet data: object = JSON.parse(stringData);\n\t\t\treturn Util.getNestedValue(data, path);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet stringData: string = await this._storage.get(key);\n\t\t\tif (typeof stringData === 'undefined') return;\n\t\t\treturn JSON.parse(stringData);\n\t\t}\n\t}\n\n\t/**\n\t * Check if a value exists in storage\n\t * @param {string} key The key in storage to check\n\t * @returns {Promise<boolean>}\n\t */\n\tpublic async exists(key: string): Promise<boolean>\n\t{\n\t\treturn typeof await this.get(key) !== 'undefined';\n\t}\n\n\t/**\n\t * Set a value in this storage for the specified key\n\t * @param {string} key The key in storage to set\n\t * @param {any} value The value to set\n\t * @returns {Promise<void>}\n\t */\n\tpublic async set(key: string, value: any): Promise<void>\n\t{\n\t\tif (typeof key === 'undefined') throw new TypeError('Key must be provided');\n\t\tif (typeof key !== 'string') throw new TypeError('Key must be a string');\n\t\tif (typeof value === 'undefined') throw new TypeError('Value must be provided');\n\n\t\ttry { JSON.stringify(value); }\n\t\tcatch { value = {}; }\n\n\t\tlet data: any;\n\t\tif (key.includes('.'))\n\t\t{\n\t\t\tlet path: string[] = key.split('.');\n\t\t\tkey = path.shift();\n\n\t\t\tdata = await this.get(key);\n\t\t\tif (typeof data === 'undefined') data = {};\n\n\t\t\tUtil.assignNestedValue(data, path, value);\n\t\t}\n\t\telse data = value;\n\n\t\tawait this._storage.set(key, JSON.stringify(data));\n\t}\n\n\t/**\n\t * Remove a key/value pair from this storage\n\t * @param {string} key The key in storage to remove\n\t * @returns {Promise<void>}\n\t */\n\tpublic async remove(key: string): Promise<void>\n\t{\n\t\tif (typeof key === 'undefined') throw new Error('Key must be provided');\n\t\tif (typeof key !== 'string') throw new Error('Key must be a string');\n\n\t\tlet data: any;\n\t\tif (key.includes('.'))\n\t\t{\n\t\t\tlet path: string[] = key.split('.');\n\t\t\tkey = path.shift();\n\n\t\t\tdata = await this.get(key);\n\t\t\tif (typeof data !== 'undefined')\n\t\t\t\tUtil.removeNestedValue(data, path);\n\n\t\t\tawait this._storage.set(key, JSON.stringify(data));\n\t\t}\n\t\telse await this._storage.remove(key);\n\t}\n\n\t/**\n\t * Remove all key/value pairs from this storage\n\t * @returns {Promise<void>}\n\t */\n\tpublic async clear(): Promise<void>\n\t{\n\t\tawait this._storage.clear();\n\t}\n}\n"],"sourceRoot":"../../src"}