{"version":3,"sources":["client/Client.ts"],"names":[],"mappings":"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","file":"Client.js","sourcesContent":["import 'reflect-metadata';\nimport * as Discord from 'discord.js';\nimport * as path from 'path';\n\nimport {\n\tChannel,\n\tClientOptions,\n\tCollection,\n\tEmoji,\n\tGuild,\n\tGuildMember,\n\tMessage,\n\tMessageReaction,\n\tRole,\n\tUser,\n\tUserResolvable,\n\tClientUserSettings,\n\tSnowflake,\n\tClientUserGuildSettings\n} from 'discord.js';\n\nimport { Command } from '../command/Command';\nimport { CommandDispatcher } from '../command/CommandDispatcher';\nimport { CommandLoader } from '../command/CommandLoader';\nimport { CommandRegistry } from '../command/CommandRegistry';\nimport { ResolverLoader } from '../command/resolvers/ResolverLoader';\nimport { RateLimitManager } from '../command/RateLimitManager';\nimport { JSONProvider } from '../storage/JSONProvider';\nimport { ClientStorage } from '../storage/ClientStorage';\nimport { GuildStorageLoader } from '../storage/GuildStorageLoader';\nimport { StorageProviderConstructor } from '../types/StorageProviderConstructor';\nimport { YAMDBFOptions } from '../types/YAMDBFOptions';\nimport { MiddlewareFunction } from '../types/MiddlewareFunction';\nimport { BaseCommandName } from '../types/BaseCommandName';\nimport { Logger, logger } from '../util/logger/Logger';\nimport { ListenerUtil } from '../util/ListenerUtil';\nimport { Lang } from '../localization/Lang';\nimport { PluginLoader } from './PluginLoader';\nimport { PluginConstructor } from '../types/PluginConstructor';\nimport { ResolverConstructor } from '../types/ResolverConstructor';\nimport { Util } from '../util/Util';\nimport { Time } from '../util/Time';\nimport { GuildStorage } from '../storage/GuildStorage';\n\nconst { on, once, registerListeners } = ListenerUtil;\n\n/**\n * The YAMDBF Client through which you can access [storage]{@link Client#storage}\n * and any of the properties available on a typical Discord.js Client instance\n * @extends {external:Client}\n * @param {YAMDBFOptions} options Object containing required client properties\n * @param {external:ClientOptions} [clientOptions] Discord.js ClientOptions\n */\nexport class Client extends Discord.Client\n{\n\t@logger('Client')\n\tprivate readonly _logger: Logger;\n\tprivate readonly _token: string;\n\tprivate readonly _plugins: (PluginConstructor | string)[];\n\tprivate readonly _guildStorageLoader: GuildStorageLoader;\n\tprivate readonly _commandLoader: CommandLoader;\n\tprivate readonly _dispatcher: CommandDispatcher;\n\tprivate _ratelimit: string;\n\n\tpublic readonly commandsDir: string;\n\tpublic readonly localeDir: string;\n\tpublic readonly owner: string[];\n\tpublic readonly defaultLang: string;\n\tpublic readonly statusText: string;\n\tpublic readonly readyText: string;\n\tpublic readonly unknownCommandError: boolean;\n\tpublic readonly selfbot: boolean;\n\tpublic readonly passive: boolean;\n\tpublic readonly pause: boolean;\n\tpublic readonly disableBase: BaseCommandName[];\n\tpublic readonly provider: StorageProviderConstructor;\n\tpublic readonly plugins: PluginLoader;\n\tpublic readonly storage: ClientStorage;\n\tpublic readonly commands: CommandRegistry<this>;\n\tpublic readonly rateLimitManager: RateLimitManager;\n\tpublic readonly resolvers: ResolverLoader;\n\tpublic readonly argsParser: (input: string, command?: Command, message?: Message) => string[];\n\n\t// Internals\n\tpublic readonly _middleware: MiddlewareFunction[];\n\tpublic readonly _customResolvers: ResolverConstructor[];\n\n\tpublic constructor(options: YAMDBFOptions, clientOptions?: ClientOptions)\n\t{\n\t\tsuper(clientOptions);\n\t\tReflect.defineMetadata('YAMDBFClient', true, this);\n\n\t\tthis._token = options.token;\n\n\t\t/**\n\t\t * The owner/owners of the bot, represented as an array of IDs.\n\t\t * These IDs determine who is allowed to use commands flagged as\n\t\t * `ownerOnly`\n\t\t * @type {string[]}\n\t\t */\n\t\tthis.owner = typeof options.owner !== 'undefined'\n\t\t\t? options.owner instanceof Array\n\t\t\t\t? options.owner\n\t\t\t\t: [options.owner]\n\t\t\t: [];\n\n\t\t/**\n\t\t * Directory to find command class files. Optional\n\t\t * if client is passive.<br>\n\t\t * **See:** {@link Client#passive}\n\t\t * @type {string}\n\t\t */\n\t\tthis.commandsDir = options.commandsDir ? path.resolve(options.commandsDir) : null;\n\n\t\t/**\n\t\t * Directory to find custom localization files\n\t\t */\n\t\tthis.localeDir = options.localeDir ? path.resolve(options.localeDir) : null;\n\n\t\t/**\n\t\t * Default language to use for localization\n\t\t * @type {string}\n\t\t */\n\t\tthis.defaultLang = options.defaultLang || 'en_us';\n\n\t\t/**\n\t\t * Status text for the client\n\t\t * @type {string}\n\t\t */\n\t\tthis.statusText = options.statusText || null;\n\n\t\t/**\n\t\t * Text to output when the client is ready. If not\n\t\t * provided nothing will be logged, giving the\n\t\t * opportunity to log something more dynamic\n\t\t * on `clientReady`\n\t\t * @type {string}\n\t\t */\n\t\tthis.readyText = options.readyText;\n\n\t\t/**\n\t\t * Whether or not a generic 'command not found' message\n\t\t * should be given in DMs to instruct the user to\n\t\t * use the `help` command. `true` by default\n\t\t * @type {string}\n\t\t */\n\t\tthis.unknownCommandError = typeof options.unknownCommandError === 'undefined' ?\n\t\t\ttrue : options.unknownCommandError;\n\n\t\t/**\n\t\t * Whether or not the client is a selfbot\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.selfbot = options.selfbot || false;\n\n\t\t/**\n\t\t * Whether or not this client is passive. Passive clients\n\t\t * will not register a command dispatcher or a message\n\t\t * listener. This allows passive clients to be created that\n\t\t * do not respond to any commands but are able to perform\n\t\t * actions based on whatever the framework user wants\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.passive = options.passive || false;\n\n\t\t/**\n\t\t * Whether or not the client will pause after loading Client\n\t\t * Storage, giving the opportunity to add/change default\n\t\t * settings before guild settings are created for the first\n\t\t * time. If this is used, you must create a listener for `'pause'`,\n\t\t * and call `<Client>.continue()` when you have finished doing\n\t\t * what you need to do.\n\t\t *\n\t\t * If adding new default settings is desired *after* guild settings\n\t\t * have already been generated for the first time, they should be\n\t\t * added after `'clientReady'` so they can be properly pushed to\n\t\t * the settings for all guilds\n\t\t * @type {boolean}\n\t\t */\n\t\tthis.pause = options.pause || false;\n\n\t\t/**\n\t\t * Array of base command names to skip when loading commands. Base commands\n\t\t * may only be disabled by name, not by alias\n\t\t * @type {BaseCommandName[]}\n\t\t */\n\t\tthis.disableBase = options.disableBase || [];\n\n\t\t// Set the global ratelimit if provided\n\t\tif (options.ratelimit) this.ratelimit = options.ratelimit;\n\n\t\t/**\n\t\t * A convenient instance of {@link RateLimitManager} for use anywhere\n\t\t * the Client is available\n\t\t * @type {RateLimitManager}\n\t\t */\n\t\tthis.rateLimitManager = new RateLimitManager();\n\n\t\t// Set the logger level if provided\n\t\tif (typeof options.logLevel !== 'undefined')\n\t\t\tthis._logger.setLogLevel(options.logLevel);\n\n\t\t/**\n\t\t * The chosen storage provider to use for the Client.\n\t\t * Defaults to {@link JSONProvider}\n\t\t * @type {StorageProvider}\n\t\t */\n\t\tthis.provider = options.provider || JSONProvider;\n\n\t\t// Plugins to load\n\t\tthis._plugins = options.plugins || [];\n\n\t\t/**\n\t\t * Loads plugins and contains loaded plugins in case\n\t\t * accessing a loaded plugin at runtime is desired\n\t\t * @type {PluginLoader}\n\t\t */\n\t\tthis.plugins = new PluginLoader(this, this._plugins);\n\n\t\t// Middleware function storage for the client instance\n\t\tthis._middleware = [];\n\n\t\t/**\n\t\t * Client-specific storage. Also contains a `guilds` Collection property containing\n\t\t * all GuildStorage instances\n\t\t * @type {ClientStorage}\n\t\t */\n\t\tthis.storage = new ClientStorage(this);\n\n\t\tthis._guildStorageLoader = new GuildStorageLoader(this);\n\n\t\t/**\n\t\t * [Collection]{@link external:Collection} containing all loaded commands\n\t\t * @type {CommandRegistry<string, Command>}\n\t\t */\n\t\tthis.commands = new CommandRegistry<this, string, Command<this>>(this);\n\n\t\t/**\n\t\t * ResolverLoader instance containing loaded argument resolvers\n\t\t * @type {ResolverLoader}\n\t\t */\n\t\tthis.resolvers = new ResolverLoader(this);\n\t\tthis._customResolvers = options.customResolvers || [];\n\t\tthis.resolvers._loadResolvers();\n\n\t\t/**\n\t\t * The argument parsing function the framework will use to parse\n\t\t * command arguments from message content input. Defaults to\n\t\t * splitting on {@link Command#argOpts.separator}\n\t\t * @type {Function}\n\t\t */\n\t\tthis.argsParser = options.argsParser || Util.parseArgs;\n\n\t\tLang.createInstance(this);\n\t\tLang.loadLocalizations();\n\n\t\tif (!this.passive)\n\t\t{\n\t\t\tthis._commandLoader = new CommandLoader(this);\n\t\t\tthis._dispatcher = new CommandDispatcher(this);\n\n\t\t\tthis._logger.info('Loading base commands...');\n\t\t\tthis._commandLoader.loadCommandsFrom(path.join(__dirname, '../command/base'), true);\n\n\t\t\t// Disable setlang command if there is only one language\n\t\t\tif (Lang.langNames.length === 1 && !this.disableBase.includes('setlang'))\n\t\t\t\tthis.commands.get('setlang').disable();\n\t\t}\n\n\t\tregisterListeners(this);\n\t}\n\n//#region Event handlers\n\n\t@once('ready')\n\tprivate async __onReadyEvent(): Promise<void>\n\t{\n\t\tawait this.storage.init();\n\n\t\t// Load defaultGuildSettings into storage the first time the client is run\n\t\tif (!await this.storage.exists('defaultGuildSettings'))\n\t\t\tawait this.storage.set('defaultGuildSettings',\n\t\t\t\trequire('../storage/defaultGuildSettings.json'));\n\n\t\tif (this.pause) this.emit('pause');\n\t\telse this.__onContinueEvent();\n\n\t\tthis.user.setGame(this.statusText);\n\t}\n\n\t@once('continue')\n\tprivate async __onContinueEvent(): Promise<void>\n\t{\n\t\tawait this._guildStorageLoader.init();\n\t\tawait this._guildStorageLoader.loadStorages();\n\t\tawait this._guildStorageLoader.cleanGuilds();\n\n\t\tthis._logger.info('Loading plugins...');\n\t\tawait this.plugins._loadPlugins();\n\n\t\tif (!this.passive)\n\t\t{\n\t\t\tif (this.commandsDir)\n\t\t\t{\n\t\t\t\tthis._logger.info('Loading custom commands...');\n\t\t\t\tthis._commandLoader.loadCommandsFrom(this.commandsDir);\n\t\t\t}\n\n\t\t\tthis.commands._checkDuplicateAliases();\n\t\t\tthis.commands._checkReservedCommandNames();\n\n\t\t\tthis._logger.info('Initializing commands...');\n\t\t\tconst initSuccess: boolean = await this.commands._initCommands();\n\t\t\tthis._logger.info(`Commands initialized${initSuccess ? '' : ' with errors'}.`);\n\n\t\t\tLang.loadCommandLocalizations();\n\n\t\t\tthis._dispatcher.setReady();\n\t\t\tconst commands: number = this.commands.size;\n\t\t\tconst groups: number = this.commands.groups.length;\n\t\t\tthis._logger.info(\n\t\t\t\t`Command dispatcher ready -- ${commands} commands in ${groups} groups` );\n\t\t}\n\n\t\tif (typeof this.readyText !== 'undefined')\n\t\t\tthis._logger.log(this.readyText);\n\n\t\tthis.emit('clientReady');\n\t}\n\n\t@on('guildCreate')\n\tprivate async __onGuildCreateEvent(guild: Guild): Promise<void>\n\t{\n\t\tif (this.storage.guilds.has(guild.id))\n\t\t{\n\t\t\t// Handle guild returning to the same shard in the same session\n\t\t\tconst storage: GuildStorage = this.storage.guilds.get(guild.id);\n\t\t\tif (await storage.settings.exists('YAMDBFInternal.remove'))\n\t\t\t\tawait storage.settings.remove('YAMDBFInternal.remove');\n\t\t}\n\t\telse await this._guildStorageLoader.loadStorages();\n\t}\n\n\t@on('guildDelete')\n\tprivate __onGuildDeleteEvent(guild: Guild): void\n\t{\n\t\tthis.storage.guilds.get(guild.id).settings.set(\n\t\t\t'YAMDBFInternal.remove', Date.now() + Time.parseShorthand('7d'));\n\t}\n\n//#endregion\n\n//#region Getters/Setters\n\n\t/**\n\t * The global ratelimit for all command usage per user\n\t * @type {string}\n\t */\n\tpublic get ratelimit(): string { return this._ratelimit; }\n\tpublic set ratelimit(value: string)\n\t{\n\t\tUtil.parseRateLimit(value);\n\t\tthis._ratelimit = value;\n\t}\n\n//#endregion\n\n\t/**\n\t * Starts the login process, culminating in the `clientReady` event\n\t * @returns {Client}\n\t */\n\tpublic start(): this\n\t{\n\t\tif (!this._token)\n\t\t\tthrow new Error('Client cannot be started without being given a token.');\n\n\t\tthis.login(this._token);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Shortcut method for `<Client>.emit('continue')`\n\t * @returns {void}\n\t */\n\tprotected continue(): void\n\t{\n\t\tthis.emit('continue');\n\t}\n\n\t/**\n\t * Returns whether or not the given user is an owner\n\t * of the client/bot\n\t * @param {external:User} user User to check\n\t * @returns {boolean}\n\t */\n\tpublic isOwner(user: User): boolean\n\t{\n\t\treturn this.owner.includes(user.id);\n\t}\n\n\t/**\n\t * Set the value of a default setting key and push it to all guild\n\t * setting storages. Will not overwrite a setting in guild settings\n\t * storage if there is already an existing key with the given value\n\t * @param {string} key The key to use in settings storage\n\t * @param {any} value The value to use in settings storage\n\t * @returns {Promise<Client>}\n\t */\n\tpublic async setDefaultSetting(key: string, value: any): Promise<this>\n\t{\n\t\tawait this.storage.set(`defaultGuildSettings.${key}`, value);\n\t\tfor (const guildStorage of this.storage.guilds.values())\n\t\t\tif (!await guildStorage.settings.exists(key))\n\t\t\t\tawait guildStorage.settings.set(key, value);\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Remove a `defaultGuildSettings` item. Will not remove from any current\n\t * guild settings, but will remove the item from the defaults added to\n\t * new guild settings storages upon creation\n\t * @param {string} key The key to use in settings storage\n\t * @returns {Promise<Client>}\n\t */\n\tpublic async removeDefaultSetting(key: string): Promise<this>\n\t{\n\t\tawait this.storage.remove(`defaultGuildSettings.${key}`);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Check if a default guild setting exists\n\t * @param {string} key The default settings key to check for\n\t * @returns {Promise<boolean>}\n\t */\n\tpublic async defaultSettingExists(key: string): Promise<boolean>\n\t{\n\t\treturn await this.storage.exists(`defaultGuildSettings.${key}`);\n\t}\n\n\t/**\n\t * Shortcut to return the command prefix for the provided guild\n\t * @param {external:Guild} guild The Guild to get the prefix of\n\t * @returns {Promise<string | null>}\n\t */\n\tpublic async getPrefix(guild: Guild): Promise<string>\n\t{\n\t\tif (!guild) return null;\n\t\treturn (await this.storage.guilds.get(guild.id).settings.get('prefix')) || null;\n\t}\n\n\t/**\n\t * Clean out expired guild storage/settings\n\t * @returns {Promise<void>}\n\t */\n\tpublic async sweepStorages(): Promise<void>\n\t{\n\t\tawait this._guildStorageLoader.cleanGuilds();\n\t}\n\n\t/**\n\t * Adds a middleware function to be used when any command is called\n\t * to make modifications to args, determine if the command can\n\t * be run, or anything else you want to do every time any command\n\t * is called.\n\t *\n\t * See {@link MiddlewareFunction} for information on how a middleware\n\t * function should be represented\n\t *\n\t * Usage example:\n\t * ```\n\t * <Client>.use((message, args) => [message, args.map(a => a.toUpperCase())]);\n\t * ```\n\t * This will add a middleware function to all commands that will attempt\n\t * to transform all args to uppercase. This will of course fail if any\n\t * of the args are not a string.\n\t *\n\t * >**Note:** Middleware functions should only be added to the client one\n\t * time each and thus should not be added within any sort of event or loop.\n\t * Multiple separate middleware functions can be added to the via multiple\n\t * separate calls to this method\n\t *\n\t * >**Warning:** Do not use middleware for overriding the default argument\n\t * splitting. Use {@link YAMDBFOptions.argsParser} instead. Otherwise\n\t * you will see inconsistent results when using Command shortcuts, as\n\t * argument splitting for shortcut interpolation always happens before\n\t * middleware is run\n\t * @param {MiddlewareFunction} func The middleware function to use\n\t * @returns {Client}\n\t */\n\tpublic use(func: MiddlewareFunction): this\n\t{\n\t\tthis._middleware.push(func);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Reload custom commands. Used internally by the `reload` command\n\t * @private\n\t */\n\tpublic _reloadCustomCommands(): number\n\t{\n\t\treturn this._commandLoader.loadCommandsFrom(this.commandsDir);\n\t}\n\n//#region Discord.js events\n\n\tpublic on(event: 'channelCreate', listener: (channel: Channel) => void): this;\n\tpublic on(event: 'channelDelete', listener: (channel: Channel) => void): this;\n\tpublic on(event: 'channelPinsUpdate', listener: (channel: Channel, time: Date) => void): this;\n\tpublic on(event: 'channelUpdate', listener: (oldChannel: Channel, newChannel: Channel) => void): this;\n\tpublic on(event: 'clientUserGuildSettingsUpdate', listener: (clientUserGuildSettings: ClientUserGuildSettings) => void): this;\n\tpublic on(event: 'clientUserSettingsUpdate', listener: (clientUserSettings: ClientUserSettings) => void): this;\n\tpublic on(event: 'debug', listener: (info: string) => void): this;\n\tpublic on(event: 'disconnect', listener: (event: any) => void): this;\n\tpublic on(event: 'emojiCreate', listener: (emoji: Emoji) => void): this;\n\tpublic on(event: 'emojiDelete', listener: (emoji: Emoji) => void): this;\n\tpublic on(event: 'emojiUpdate', listener: (oldEmoji: Emoji, newEmoji: Emoji) => void): this;\n\tpublic on(event: 'error', listener: (error: Error) => void): this;\n\tpublic on(event: 'guildBanAdd', listener: (guild: Guild, user: User) => void): this;\n\tpublic on(event: 'guildBanRemove', listener: (guild: Guild, user: User) => void): this;\n\tpublic on(event: 'guildCreate', listener: (guild: Guild) => void): this;\n\tpublic on(event: 'guildDelete', listener: (guild: Guild) => void): this;\n\tpublic on(event: 'guildMemberAdd', listener: (member: GuildMember) => void): this;\n\tpublic on(event: 'guildMemberAvailable', listener: (member: GuildMember) => void): this;\n\tpublic on(event: 'guildMemberRemove', listener: (member: GuildMember) => void): this;\n\tpublic on(event: 'guildMembersChunk', listener: (members: GuildMember[], guild: Guild) => void): this;\n\tpublic on(event: 'guildMemberSpeaking', listener: (member: GuildMember, speaking: boolean) => void): this;\n\tpublic on(event: 'guildMemberUpdate', listener: (oldMember: GuildMember, newMember: GuildMember) => void): this;\n\tpublic on(event: 'guildUnavailable', listener: (guild: Guild) => void): this;\n\tpublic on(event: 'guildUpdate', listener: (oldGuild: Guild, newGuild: Guild) => void): this;\n\tpublic on(event: 'message', listener: (message: Message) => void): this;\n\tpublic on(event: 'messageDelete', listener: (message: Message) => void): this;\n\tpublic on(event: 'messageDeleteBulk', listener: (messages: Collection<Snowflake, Message>) => void): this;\n\tpublic on(event: 'messageReactionAdd', listener: (messageReaction: MessageReaction, user: User) => void): this;\n\tpublic on(event: 'messageReactionRemove', listener: (messageReaction: MessageReaction, user: User) => void): this;\n\tpublic on(event: 'messageReactionRemoveAll', listener: (message: Message) => void): this;\n\tpublic on(event: 'messageUpdate', listener: (oldMessage: Message, newMessage: Message) => void): this;\n\tpublic on(event: 'presenceUpdate', listener: (oldMember: GuildMember, newMember: GuildMember) => void): this;\n\tpublic on(event: 'ready', listener: () => void): this;\n\tpublic on(event: 'reconnecting', listener: () => void): this;\n\tpublic on(event: 'resume', listener: (replayed: number) => void): this;\n\tpublic on(event: 'roleCreate', listener: (role: Role) => void): this;\n\tpublic on(event: 'roleDelete', listener: (role: Role) => void): this;\n\tpublic on(event: 'roleUpdate', listener: (oldRole: Role, newRole: Role) => void): this;\n\tpublic on(event: 'typingStart', listener: (channel: Channel, user: User) => void): this;\n\tpublic on(event: 'typingStop', listener: (channel: Channel, user: User) => void): this;\n\tpublic on(event: 'userNoteUpdate', listener: (user: UserResolvable, oldNote: string, newNote: string) => void): this;\n\tpublic on(event: 'userUpdate', listener: (oldUser: User, newUser: User) => void): this;\n\tpublic on(event: 'voiceStateUpdate', listener: (oldMember: GuildMember, newMember: GuildMember) => void): this;\n\tpublic on(event: 'warn', listener: (info: string) => void): this;\n\n//#endregion\n\n\tpublic on(event: 'command', listener: (name: string, args: any[], execTime: number, message: Message) => void): this;\n\tpublic on(event: 'blacklistAdd', listener: (user: User, global: boolean) => void): this;\n\tpublic on(event: 'blacklistRemove', listener: (user: User, global: boolean) => void): this;\n\tpublic on(event: 'pause', listener: () => void): this;\n\tpublic on(event: 'continue', listener: () => void): this;\n\tpublic on(event: 'clientReady', listener: () => void): this;\n\n\t/**\n\t * Emitted whenever a command is successfully called\n\t * @memberof Client\n\t * @event event:command\n\t * @param {string} name Name of the called command\n\t * @param {any[]} args Args passed to the called command\n\t * @param {number} execTime Time command took to execute\n\t * @param {external:Message} message Message that triggered the command\n\t */\n\n\t/**\n\t * Emitted whenever a user is blacklisted\n\t * @memberof Client\n\t * @event event:blacklistAdd\n\t * @param {User} user User who was blacklisted\n\t * @param {boolean} global Whether or not blacklisting is global\n\t */\n\n\t/**\n\t * Emitted whenever a user is removed from the blacklist\n\t * @memberof Client\n\t * @event event:blacklistRemove\n\t * @param {User} user User who was removed\n\t * @param {boolean} global Whether or not removal is global\n\t */\n\n\t/**\n\t * Emitted when the client is waiting for you to send a `continue` event,\n\t * after which `clientReady` will be emitted\n\t * @memberof Client\n\t * @event event:pause\n\t */\n\n\t/**\n\t * To be emitted after the `pause` event when you have finished setting\n\t * things up that should be set up before the client is ready for use\n\t * @memberof Client\n\t * @event event:continue\n\t */\n\n\t/**\n\t * Emitted when the client is ready. Should be used instead of Discord.js'\n\t * `ready` event, as this is the point that everything is set up within the\n\t * YAMDBF Client and it's all ready to go\n\t * @memberof Client\n\t * @event event:clientReady\n\t */\n\tpublic on(event: string, listener: Function): this\n\t{\n\t\treturn super.on(event, listener);\n\t}\n}\n"],"sourceRoot":"../../src"}